services:
  openclaw:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: openclaw
    image: openclaw:latest
    restart: unless-stopped
    network_mode: bridge
    ports:
      - "18789:18789"  # Gateway WebSocket
      - "18790:18790"  # Bridge port
    volumes:
      - ./appdata/openclaw:/home/node/.openclaw
      - ./appdata/workspace:/home/node/clawd
    environment:
      - HOME=/home/node
      - TERM=xterm-256color
      - NODE_ENV=production
      - OPENCLAW_GATEWAY_TOKEN=dev-token-testing
      # Optional: Set these for your setup
      # - CLAUDE_AI_SESSION_KEY=your-key-here
      # - CLAUDE_WEB_SESSION_KEY=your-key-here
      # - CLAUDE_WEB_COOKIE=your-cookie-here
    init: true
    command: node dist/index.js gateway --bind lan --port 18789 --allow-unconfigured
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:18789', (r) => {if (r.statusCode !== 200) throw new Error(r.statusCode)})"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
